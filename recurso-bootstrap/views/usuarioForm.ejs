<%
  const isEditMode = (typeof usuario !== 'undefined' && usuario.id_usuario);
%>

<div class="usuario-form-content">
  <h1><%= title %></h1>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger mt-2" role="alert" aria-live="assertive">
      <%= error %>
    </div>
  <% } %>

  <form id="usuarioForm" action="<%= action %>" method="POST" novalidate autocomplete="off">
    <fieldset>
      <legend class="w-auto">Datos del Usuario</legend>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="nombre" class="form-label obligatorio">Nombre:</label>
          <input type="text" id="nombre" name="nombre" class="form-control" 
                 value="<%= usuario?.nombre || '' %>" required>
        </div>

        <div class="col-md-4 mb-3">
          <label for="apellido1" class="form-label obligatorio">Primer apellido:</label>
          <input type="text" id="apellido1" name="apellido1" class="form-control" 
                 value="<%= usuario?.apellido1 || '' %>" required>
        </div>

        <div class="col-md-4 mb-3">
          <label for="apellido2" class="form-label NoObligatorio">Segundo apellido:</label>
          <input type="text" id="apellido2" name="apellido2" class="form-control"
                 value="<%= usuario?.apellido2 || '' %>">
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="email" class="form-label obligatorio">Correo electrónico:</label>
          <input type="email" id="email" name="email" class="form-control"
                 value="<%= usuario?.correo || '' %>" required>
        </div>

        <div class="col-md-4 mb-3">
          <label for="contrasenya" class="form-label <%= isEditMode ? '' : 'obligatorio' %>">
            Contraseña <%= isEditMode ? '(dejar en blanco si no se cambia)' : '' %>:
          </label>
          <input type="password" id="contrasenya" name="contrasenya" class="form-control" 
                 placeholder="<%= isEditMode ? '••••••••' : '' %>" <%= isEditMode ? '' : 'required' %>>
        </div>

        <div class="col-md-4 mb-3">
          <label for="telefono" class="form-label NoObligatorio">Teléfono:</label>
          <input type="text" id="telefono" name="telefono" class="form-control"
                 value="<%= usuario?.telefono || '' %>">
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="rol" class="form-label obligatorio">Rol:</label>
          <select id="rol" name="rol" class="form-select" required>
            <option value="">-- Selecciona un rol --</option>
            <option value="Admin" <%= (usuario?.rol === 'Admin') ? 'selected' : '' %>>Admin</option>
            <option value="Empleado" <%= (usuario?.rol === 'Empleado') ? 'selected' : '' %>>Empleado</option>
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label for="id_concesionario" class="form-label obligatorio">Concesionario:</label>
          <select id="id_concesionario" name="id_concesionario" class="form-select" required>
            <option value="0">-- Selecciona un concesionario --</option>
            <% concesionarios.forEach(c => { %>
              <option value="<%= c.id_concesionario %>" <%= (usuario?.id_concesionario == c.id_concesionario) ? 'selected' : '' %>>
                <%= c.nombre %>
              </option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label for="preferencias_accesibilidad" class="form-label NoObligatorio">Preferencias de Accesibilidad:</label>
          <textarea id="preferencias_accesibilidad" name="preferencias_accesibilidad" class="form-control" rows="3">
<%= usuario?.preferencias_accesibilidad || '' %></textarea>
        </div>
      </div>

    </fieldset>

    <div class="d-flex justify-content-end mt-3 gap-2">
      <a href="/usuarios" class="btn btn-outline-secondary">Cancelar</a>
      <button type="submit" class="btn btn-primary">
        <%= isEditMode ? 'Actualizar Usuario' : 'Crear Usuario' %>
      </button>
    </div>
  </form>
</div>
