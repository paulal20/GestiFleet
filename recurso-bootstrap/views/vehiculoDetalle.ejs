<div class="vehiculo-detalle-content">
  <div class="d-flex justify-content-end mb-5">
    <a href="/vehiculos" class="btn btn-outline-secondary">Volver a la lista</a>
  </div>
  <div class="vehiculo-card card mx-auto" style="max-width: 900px">
    <div class="row g-0">
      <div class="col-md-6">
        <div class="vehiculo-img-container h-100">
          <% if (vehiculo.tiene_imagen) { %>
          <img src="/vehiculos/<%= vehiculo.id_vehiculo %>/imagen" class="rounded-start img-cover" alt="<%= vehiculo.marca %> <%= vehiculo.modelo %>"/>
          <% } else { %>
          <div class="d-flex flex-column justify-content-center align-items-center">
            <img src="/bootstrap-icons-1.13.1/car-front-fill.svg" class="bi-svg" alt="">
            <span class="mt-2 fw-bold">Sin Imagen</span>
          </div>
          <% } %>
        </div>
      </div>

      <div class="col-md-6 d-flex flex-column">
        <div class="card-body flex-grow-1">
          <h5 class="card-title">
            <%= vehiculo.marca %> <%= vehiculo.modelo %> (<%=
            vehiculo.anyo_matriculacion %>), Matricula: <%= vehiculo.matricula
            %>
          </h5>
          <p class="card-text"><%= vehiculo.descripcion %></p>
          <div class="row">
            <div class="col-6">
              <p class="card-text">
                <strong>Tipo: </strong><%= vehiculo.tipo %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Número de plazas: </strong><%= vehiculo.numero_plazas %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Autonomía: </strong><%= vehiculo.autonomia_km %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Color: </strong><%= vehiculo.color %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Estado:</strong>
                <% if (vehiculo.estado_dinamico==='disponible' ) { %>
                <span class="badge bg-success">Disponible</span>
                <% } else if (vehiculo.estado_dinamico==='reservado' ) { %>
                <span class="badge bg-warning text-dark">Reservado</span>
                <% } %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Concesionario:</strong> <%= concesionario.nombre %>
              </p>
            </div>
          </div>
          <br />
          <p class="text-muted">Desde <%= vehiculo.precio %> €</p>
          <p class="card-text">
            <strong>Activo:</strong>
            <% if (vehiculo.activo===1 ) { %>
            <span class="badge bg-success">Activo</span>
            <% } else { %>
            <span class="badge bg-danger">Eliminado</span>
            <% } %>
          </p>
        </div>

        <div class="perfil-actions d-flex gap-2 mt-3">
          <% if (vehiculo.activo === 1) { %>
            
            <% if (vehiculo.estado_dinamico === 'disponible') { %>
              <a
                href="/reserva?idVehiculo=<%= vehiculo.id_vehiculo %><%= fechaSeleccionada ? '&fecha=' + fechaSeleccionada : '' %>"
                class="btn btn-primary flex-fill">
                Reservar
              </a>
            <% } else { %>
              <% if (!usuarioSesion || usuarioSesion.rol !== 'Admin') { %>
                <button class="btn btn-secondary flex-fill" disabled>
                  No disponible (<%= vehiculo.estado_dinamico %>)
                </button>
              <% } %>
            <% } %>

            <% if (usuarioSesion && usuarioSesion.rol === 'Admin') { %>
                <button
                  type="button"
                  class="btn btn-outline-secondary flex-fill"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmarEliminarModal"
                  data-id="<%= vehiculo.id_vehiculo %>"
                  data-name="<%= vehiculo.marca + ' ' + vehiculo.modelo %>"
                >
                  Eliminar
                </button>
                <a href="/vehiculos/<%= vehiculo.id_vehiculo %>/editar" class="btn btn-primary flex-fill">
                  Editar
                </a>
            <% } %>

          <% } else { %>
            <span class="text-muted fst-italic w-100 text-center">Este vehículo ha sido eliminado y no admite acciones.</span>
          <% } %>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="confirmarEliminarModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Eliminar Vehículo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        ¿Estás seguro de que quieres eliminar <span id="vehiculoAEliminar" class="fw-bold"></span>?
        <div class="d-flex justify-content-end mt-3 gap-2">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          
          <form id="formEliminar" action="#" class="m-0 p-0">
             <button type="submit" class="btn btn-primary">Eliminar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/jquery-3.7.1.min.js"></script>
<script src="/js/ajax/vehiculos/vehiculoDetalle.js"></script>
<script src="/js/modal.js"></script>