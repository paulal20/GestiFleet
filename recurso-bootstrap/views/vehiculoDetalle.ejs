<div class="vehiculo-detalle-content">
  <div class="d-flex justify-content-end">
    <a href="/vehiculos" class="btn btn-outline-secondary">Volver a la lista</a>
  </div>
  <div class="vehiculo-card card mx-auto" style="max-width: 900px">
    <div class="row g-0">
      <div class="col-md-6">
        <div class="vehiculo-img-container h-100">
          <% if (vehiculo.tiene_imagen) { %>
          <img
            src="/vehiculos/<%= vehiculo.id_vehiculo %>/imagen"
            class="rounded-start img-cover"
            alt="<%= vehiculo.marca %> <%= vehiculo.modelo %>"
          />
          <% } else { %>
          <div
            class="d-flex flex-column justify-content-center align-items-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="200"
              height="200"
              fill="currentColor"
              class="bi bi-car-front-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m10 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM2.906 5.189a.51.51 0 0 0 .497.731c.91-.073 3.35-.17 4.597-.17s3.688.097 4.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 11.691 3H4.309a.5.5 0 0 0-.447.276L2.906 5.19Z"
              />
            </svg>
            <span class="mt-2 fw-bold">Sin Imagen</span>
          </div>
          <% } %>
        </div>
      </div>

      <div class="col-md-6 d-flex flex-column">
        <div class="card-body flex-grow-1">
          <h5 class="card-title">
            <%= vehiculo.marca %> <%= vehiculo.modelo %> (<%=
            vehiculo.anyo_matriculacion %>), Matricula: <%= vehiculo.matricula
            %>
          </h5>
          <p class="card-text"><%= vehiculo.descripcion %></p>
          <div class="row">
            <div class="col-6">
              <p class="card-text">
                <strong>Tipo: </strong><%= vehiculo.tipo %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Número de plazas: </strong><%= vehiculo.numero_plazas %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Autonomía: </strong><%= vehiculo.autonomia_km %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Color: </strong><%= vehiculo.color %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Estado:</strong>
                <% if (vehiculo.estado==='disponible' ) { %>
                <span class="badge bg-success">Disponible</span>
                <% } else if (vehiculo.estado==='reservado' ) { %>
                <span class="badge bg-warning text-dark">Reservado</span>
                <% } else { %>
                <span class="badge bg-danger">Mantenimiento</span>
                <% } %>
              </p>
            </div>
            <div class="col-6">
              <p class="card-text">
                <strong>Concesionario:</strong> <%= concesionario.nombre %>
              </p>
            </div>
          </div>
          <br />
          <p class="text-muted">Desde <%= vehiculo.precio %> €</p>
          <p class="card-text">
            <strong>Activo:</strong>
            <% if (vehiculo.activo===1 ) { %>
            <span class="badge bg-success">Activo</span>
            <% } else { %>
            <span class="badge bg-danger">Eliminado</span>
            <% } %>
          </p>
        </div>

        <div class="perfil-actions d-flex gap-2 mt-3">
          <% if (vehiculo.activo === 1) { %>
            
            <% if (vehiculo.estado === 'disponible') { %>
                <a
                  href="/reserva?idVehiculo=<%= vehiculo.id_vehiculo %>"
                  class="btn btn-primary flex-fill"
                >
                  Reservar
                </a>
            <% } else { %>
                <% if (!usuarioSesion || usuarioSesion.rol !== 'Admin') { %>
                    <button class="btn btn-secondary flex-fill" disabled>
                        No disponible (<%= vehiculo.estado %>)
                    </button>
                <% } %>
            <% } %>

            <% if (usuarioSesion && usuarioSesion.rol === 'Admin') { %>
                <button
                  type="button"
                  class="btn btn-outline-secondary flex-fill"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmarEliminarModal"
                  data-id="<%= vehiculo.id_vehiculo %>"
                  data-name="<%= vehiculo.marca + ' ' + vehiculo.modelo %>"
                >
                  Eliminar
                </button>
                <a
                  href="/vehiculos/<%= vehiculo.id_vehiculo %>/editar"
                  class="btn btn-primary flex-fill"
                >
                  Editar
                </a>
            <% } %>

          <% } else { %>
            <span class="text-muted fst-italic w-100 text-center">Este vehículo ha sido eliminado y no admite acciones.</span>
          <% } %>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="confirmarEliminarModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Eliminar Vehículo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        ¿Estás seguro de que quieres eliminar <span id="vehiculoAEliminar" class="fw-bold"></span>?
        <div class="d-flex justify-content-end mt-3 gap-2">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          
          <form id="formEliminar" action="#" class="m-0 p-0">
             <button type="submit" class="btn btn-primary">Eliminar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/ajax/vehiculos/vehiculoDetalle.js"></script>
<script src="/js/modal.js"></script>