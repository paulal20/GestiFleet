<div class="listaconcesionarios-content">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><%= title %></h1>
    <% if (usuario && usuario.rol === 'Admin') { %>
      <a href="/concesionarios/nuevo" class="btn btn-primary btn-lg">
        <span class="lang lang-es">Nuevo Concesionario</span>
        <span class="lang lang-en d-none">New Dealership</span>
      </a>
    <% } %>
  </div>

  <form action="/concesionarios" method="GET" class="mb-4">
    <fieldset>
      <legend class="w-auto">Filtros</legend>

      <div class="row g-3">
        <div class="col-md-6 col-lg-4">
          <label for="filtroCiudad" class="form-label">Ciudad</label>
          <select name="ciudad" id="filtroCiudad" class="form-select">
            <option value="" <%= (ciudadSeleccionada === '') ? 'selected' : '' %>>
              Todas las Ciudades
            </option>
            <% if (ciudadesDisponibles && ciudadesDisponibles.length > 0) { %>
              <% ciudadesDisponibles.forEach(c => { %>
                <option value="<%= c %>" <%= (c === ciudadSeleccionada) ? 'selected' : '' %>>
                  <%= c %>
                </option>
              <% }) %>
            <% } %>
          </select>
        </div>

        <div class="col-md-6 col-lg-4 d-flex align-items-end gap-2">
          <button type="submit" class="btn btn-primary w-100">Filtrar</button>
          <a href="/concesionarios" class="btn btn-outline-secondary w-100">Limpiar</a>
        </div>
      </div> </fieldset>
  </form>
  <% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger" role="alert" aria-live="assertive">
      <%= error %>
    </div>
  <% } %>
      
  <% if (concesionarios && concesionarios.length > 0) { %>
    <div class="table-responsive-md">
      <table class="table table-hover" aria-describedby="tabla-concesionarios-descripcion">
        <caption class="text-center">
          Concesionarios mostrados: <strong><%= concesionarios.length %></strong>
        </caption>
        <thead class="table-dark">
          <tr>
            <th scope="col">Nombre</th>
            <th scope="col">Ciudad</th>
            <th scope="col">Dirección</th>
            <th scope="col">Teléfono</th>
            <% if (usuario && usuario.rol === 'Admin') { %>
              <th scope="col">Acciones</th>
            <% } %>
          </tr>
        </thead>
        <tbody>
          <% concesionarios.forEach(c => { %>
            <tr>
              <td class="fila-click" data-href="/concesionarios/<%= c.id_concesionario %>"><%= c.nombre %></td>
              <td class="fila-click" data-href="/concesionarios/<%= c.id_concesionario %>"><%= c.ciudad %></td>
              <td class="fila-click" data-href="/concesionarios/<%= c.id_concesionario %>"><%= c.direccion %></td>
              <td class="fila-click" data-href="/concesionarios/<%= c.id_concesionario %>"><%= c.telefono_contacto %></td>
              <% if (usuario && usuario.rol === 'Admin') { %>
                <td>
                  <button 
                    type="button" 
                    class="btn btn-secondary btn-sm mb1"
                    data-bs-toggle="modal"
                    data-bs-target="#confirmarEliminarConcesionarioModal"
                    data-id="<%= c.id_concesionario %>"
                    data-name="<%= c.nombre %>">
                    <span class="lang lang-es">Eliminar</span>
                    <span class="lang lang-en d-none">Delete</span>
                  </button>
                  <a href="/concesionarios/<%= c.id_concesionario %>/editar" 
                    class="btn btn-primary btn-sm me-2 mb-1">
                    <span class="lang lang-es">Editar</span>
                    <span class="lang lang-en d-none">Edit</span>
                  </a>
                </td>
              <% } %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <div id="tabla-concesionarios-descripcion" class="visually-hidden">
      Listado de concesionarios. Al hacer clic en una fila, se navega a su detalle.
    </div>

  <% } else if (typeof error === 'undefined' || !error) { %> 
    <div class="alert alert-info text-center" role="alert">
      <h4 class="alert-heading">No hay concesionarios</h4>
      <p class="mb-0">No se encontraron concesionarios para la selección actual.</p>
    </div>
  <% } %>
</div>

<div class="modal fade" id="confirmarEliminarConcesionarioModal" tabindex="-1" aria-labelledby="confirmarEliminarConcesionarioModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="confirmarEliminarConcesionarioModalLabel">Eliminar Concesionario</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body">
        <p id="textoConfirmacionConcesionario">
          ¿Estás seguro de que deseas eliminar este concesionario?
        </p>

        <div class="d-flex justify-content-end mt-3 gap-2">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>

          <form id="formEliminarConcesionario" action="" method="POST" class="m-0 p-0">
            <button type="submit" class="btn btn-primary">Eliminar</button>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

<script src="/js/modal.js"></script>